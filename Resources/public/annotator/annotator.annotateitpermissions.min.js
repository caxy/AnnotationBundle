/*
** Annotator v1.2.7
** https://github.com/okfn/annotator/
**
** Copyright 2012 Aron Carroll, Rufus Pollock, and Nick Stenning.
** Dual licensed under the MIT and GPLv3 licenses.
** https://github.com/okfn/annotator/blob/master/LICENSE
**
** Built at: 2013-06-27 21:49:32Z
*/((function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c={}.hasOwnProperty,d=function(a,b){function e(){this.constructor=a}for(var d in b)c.call(b,d)&&(a[d]=b[d]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a},e=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};Annotator.Plugin.AnnotateItPermissions=function(c){function f(){return this._setAuthFromToken=b(this._setAuthFromToken,this),this.updateAnnotationPermissions=b(this.updateAnnotationPermissions,this),this.updatePermissionsField=b(this.updatePermissionsField,this),this.addFieldsToAnnotation=b(this.addFieldsToAnnotation,this),a=f.__super__.constructor.apply(this,arguments),a}return d(f,c),f.prototype.options={showViewPermissionsCheckbox:!0,showEditPermissionsCheckbox:!0,groups:{world:"group:__world__",authenticated:"group:__authenticated__",consumer:"group:__consumer__"},userId:function(a){return a.userId},userString:function(a){return a.userId},userAuthorize:function(a,b,c){var d,f,g,h,i,j;return f=b.permissions||{},d=f[a]||[],(g=this.groups.world,e.call(d,g)>=0)?!0:c!=null&&c.userId!=null&&c.consumerKey!=null?c.userId===b.user&&c.consumerKey===b.consumer?!0:(h=this.groups.authenticated,e.call(d,h)>=0)?!0:c.consumerKey===b.consumer&&(i=this.groups.consumer,e.call(d,i)>=0)?!0:c.consumerKey===b.consumer&&(j=c.userId,e.call(d,j)>=0)?!0:c.consumerKey===b.consumer&&c.admin?!0:!1:!1},permissions:{read:["group:__world__"],update:[],"delete":[],admin:[]}},f.prototype.addFieldsToAnnotation=function(a){if(a){a.permissions=this.options.permissions;if(this.user)return a.user=this.user.userId,a.consumer=this.user.consumerKey}},f.prototype.updatePermissionsField=function(a,b,c){var d;return b=$(b).show(),d=b.find("input").removeAttr("disabled"),this.authorize("admin",c)||b.hide(),this.user&&this.authorize(a,c||{},{userId:"__nonexistentuser__",consumerKey:this.user.consumerKey})?d.attr("checked","checked"):d.removeAttr("checked")},f.prototype.updateAnnotationPermissions=function(a,b,c){var d;return c.permissions||(c.permissions=this.options.permissions),d=a+"-permissions",$(b).find("input").is(":checked")?c.permissions[a]=[a==="read"?this.options.groups.world:this.options.groups.consumer]:c.permissions[a]=[]},f.prototype._setAuthFromToken=function(a){return this.setUser(a)},f}(Annotator.Plugin.Permissions)})).call(this);